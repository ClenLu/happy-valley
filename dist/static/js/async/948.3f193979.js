"use strict";(self.webpackChunkgame_paradise=self.webpackChunkgame_paradise||[]).push([["948"],{327(t,e,s){s.r(e),s.d(e,{component:()=>v});var a=s(367),i=s(951),l=s(750);function r(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}let o={coral:{fill:"#FF9A8B",stroke:"#E07A6B",highlight:"#FFB5A8"},mint:{fill:"#7DD3B0",stroke:"#5AB090",highlight:"#A0E8CB"},sky:{fill:"#7EC8E8",stroke:"#5CA8C8",highlight:"#A5DBEF"},lemon:{fill:"#FFE066",stroke:"#E0C050",highlight:"#FFEB99"},lavender:{fill:"#B8A4D8",stroke:"#9484B8",highlight:"#D0C2E8"},peach:{fill:"#FFB07C",stroke:"#E09060",highlight:"#FFC9A0"}},n=["coral","mint","sky","lemon","lavender","peach"],h=0;class d{update(t){let e=t/1e3;"floating"===this.data.state?(this.data.y-=60*this.data.speed*e,this.data.phase+=2*e,this.data.rotation=5*Math.sin(this.data.phase)):"popping"===this.data.state&&(this.data.popProgress+=4*e,this.data.popProgress<.3?this.data.scale=1-.5*this.data.popProgress:this.data.popProgress<.6?this.data.scale=.85+(this.data.popProgress-.3)*2:this.data.scale=Math.max(0,1.45-(this.data.popProgress-.6)*4),this.data.popProgress>=1&&(this.data.state="done"))}getRenderX(){return this.data.x+Math.sin(this.data.phase)*this.data.swingAmplitude}pop(){"floating"===this.data.state&&(this.data.state="popping",this.data.popProgress=0)}hitTest(t,e){if("floating"!==this.data.state)return!1;let s=this.getRenderX(),a=this.data.y-d.HEIGHT/2,i=d.WIDTH/2+20,l=t-s,r=e-a;return l*l+r*r<=i*i}isOffScreen(){return this.data.y+d.HEIGHT<0}getColors(){return o[this.data.color]}isDone(){return"done"===this.data.state}startFlash(){this._isFlashing=!0,this._flashTimer=0}stopFlash(){this._isFlashing=!1}isFlashing(){return this._isFlashing}updateFlash(t){return this._isFlashing?(this._flashTimer+=t/1e3,Math.sin(10*this._flashTimer)>0?1:.5):1}constructor(t,e,s,a){r(this,"data",void 0),r(this,"_flashTimer",0),r(this,"_isFlashing",!1),this.data={id:++h,letter:t,x:e,y:s,color:n[Math.floor(Math.random()*n.length)],state:"floating",phase:Math.random()*Math.PI*2,swingAmplitude:15+10*Math.random(),speed:a,scale:1,rotation:0,popProgress:0}}}r(d,"WIDTH",80),r(d,"HEIGHT",100);class c{resize(t,e){this.width=t,this.height=e}clear(){this.ctx.clearRect(0,0,this.width*this.dpr,this.height*this.dpr)}drawBackground(){let t=this.ctx.createLinearGradient(0,0,0,this.height*this.dpr);t.addColorStop(0,"#F0F8FF"),t.addColorStop(.5,"#FFFBF5"),t.addColorStop(1,"#FFF8F0"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.width*this.dpr,this.height*this.dpr)}drawBalloon(t){if("done"===t.data.state)return;let e=this.ctx,{scale:s,rotation:a}=t.data,i=t.getColors(),l=t.updateFlash(16),r=t.getRenderX()*this.dpr,o=t.data.y*this.dpr,n=d.WIDTH*this.dpr*s,h=d.HEIGHT*this.dpr*s;e.save(),e.translate(r,o-h/2),e.rotate(a*Math.PI/180),e.globalAlpha=l,this.drawRibbon(e,0,h/2,i.stroke),this.drawBalloonBody(e,0,0,n,h,i),this.drawLetter(e,0,0,t.data.letter,n),e.restore()}drawBalloonBody(t,e,s,a,i,l){t.beginPath();let r=.85*i;t.ellipse(e,s,a/2,r/2,0,0,2*Math.PI);let o=t.createRadialGradient(e-.2*a,s-.2*r,0,e,s,a/2);o.addColorStop(0,l.highlight),o.addColorStop(.5,l.fill),o.addColorStop(1,l.stroke),t.fillStyle=o,t.fill(),t.strokeStyle=l.stroke,t.lineWidth=2*this.dpr,t.stroke();let n=r/2;t.beginPath(),t.moveTo(e-.08*a,n),t.lineTo(e,n+.08*i),t.lineTo(e+.08*a,n),t.closePath(),t.fillStyle=l.stroke,t.fill(),t.beginPath(),t.ellipse(e-.2*a,s-.25*r,.12*a,.08*a,-.5,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.6)",t.fill()}drawRibbon(t,e,s,a){let i=40*this.dpr;t.beginPath(),t.moveTo(e,s);for(let a=1;a<=4;a++){let l=8*Math.sin(.8*a)*this.dpr,r=s+i/4*a;t.quadraticCurveTo(e+l,r-5*this.dpr,e+.5*l,r)}t.strokeStyle=a,t.lineWidth=2*this.dpr,t.lineCap="round",t.stroke()}drawLetter(t,e,s,a,i){t.font=`bold ${.5*i}px "Nunito", "Comic Sans MS", cursive`,t.textAlign="center",t.textBaseline="middle",t.fillStyle="rgba(0, 0, 0, 0.15)",t.fillText(a,e+2*this.dpr,s+2*this.dpr),t.fillStyle="#FFFFFF",t.fillText(a,e,s)}drawBalloons(t){for(let e of[...t].sort((t,e)=>t.data.y-e.data.y))this.drawBalloon(e)}drawParticles(t){let e=this.ctx;for(let s of t){let t=s.life/s.maxLife;e.save(),e.globalAlpha=t,e.translate(s.x*this.dpr,s.y*this.dpr),e.rotate(s.rotation),"star"===s.type?this.drawStar(e,0,0,s.size*this.dpr,s.color):this.drawConfetti(e,0,0,s.size*this.dpr,s.color),e.restore()}}drawStar(t,e,s,a,i){let l=.5*a;t.beginPath();for(let i=0;i<10;i++){let r=i%2==0?a:l,o=i*Math.PI/5-Math.PI/2,n=e+Math.cos(o)*r,h=s+Math.sin(o)*r;0===i?t.moveTo(n,h):t.lineTo(n,h)}t.closePath(),t.fillStyle=i,t.fill()}drawConfetti(t,e,s,a,i){t.fillStyle=i,t.fillRect(e-a/2,s-a/4,a,a/2)}drawTargetHint(t,e){let s=this.ctx,a=this.width*this.dpr/2;s.save(),s.font=`bold ${24*this.dpr}px "Nunito", sans-serif`,s.textAlign="center",s.textBaseline="middle",s.fillStyle="#4A4A4A",s.fillText(`找到字母 ${t}!`,a,e*this.dpr),s.restore()}constructor(t){r(this,"ctx",void 0),r(this,"width",void 0),r(this,"height",void 0),r(this,"dpr",void 0);const e=t.getContext("2d");if(!e)throw Error("Failed to get 2d context");this.ctx=e,this.dpr=window.devicePixelRatio||1,this.width=t.width/this.dpr,this.height=t.height/this.dpr}}let p=["#FF9A8B","#7DD3B0","#7EC8E8","#FFE066","#B8A4D8","#FFB07C"];class u{createExplosion(t,e,s,a){let i=o[s],l=a?20:8;for(let s=0;s<l;s++){let r=2*Math.PI*s/l+.5*Math.random(),o=100+150*Math.random(),n=a&&s<l/2;this.particles.push({x:t,y:e,vx:Math.cos(r)*o,vy:Math.sin(r)*o-50,size:n?8+6*Math.random():5+4*Math.random(),color:a?s%2==0?"#FFE066":p[Math.floor(Math.random()*p.length)]:i.fill,life:1,maxLife:1,type:n?"star":"confetti",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*10})}}update(t){let e=t/1e3;for(let t of this.particles)t.x+=t.vx*e,t.y+=t.vy*e,t.vy+=300*e,t.vx*=.98,t.life-=1.5*e,t.rotation+=t.rotationSpeed*e;this.particles=this.particles.filter(t=>t.life>0)}getParticles(){return this.particles}clear(){this.particles=[]}constructor(){r(this,"particles",[])}}let f="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),g={1:{balloonCount:2,baseSpeed:.5,spawnInterval:2e3},2:{balloonCount:3,baseSpeed:.6,spawnInterval:1800},3:{balloonCount:4,baseSpeed:.7,spawnInterval:1600},4:{balloonCount:5,baseSpeed:.8,spawnInterval:1400}},m=[3,5,8];class b{resize(t,e){this.width=t,this.height=e,this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr,this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`,this.renderer.resize(t,e)}start(){this.state.phase="playing",this.state.difficulty=1,this.state.consecutiveCorrect=0,this.state.score=0,this.balloons=[],this.particleSystem.clear(),this.startNewRound(),this.lastTime=performance.now(),this.gameLoop()}stop(){null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.state.phase="ready"}startNewRound(){this.balloons=this.balloons.filter(t=>"popping"===t.data.state),this.state.targetLetter=f[Math.floor(Math.random()*f.length)];let t=g[this.state.difficulty],e=function(t,e){let s=[...f],a=[];if(e){a.push(e);let t=s.indexOf(e);t>-1&&s.splice(t,1)}for(;a.length<t&&s.length>0;){let t=Math.floor(Math.random()*s.length);a.push(s[t]),s.splice(t,1)}var i=a;let l=[...i];for(let t=l.length-1;t>0;t--){let e=Math.floor(Math.random()*(t+1));[l[t],l[e]]=[l[e],l[t]]}return l}(t.balloonCount,this.state.targetLetter),s=(this.width-120)/(e.length+1);for(let a=0;a<e.length;a++){let i=60+s*(a+1),l=this.height+50+30*Math.random(),r=t.baseSpeed+.2*Math.random();this.balloons.push(new d(e[a],i,l,r))}this.spawnProtectionTime=this.SPAWN_PROTECTION_MS,this.callbacks.onNewRound(this.state.targetLetter)}update(t){if("playing"===this.state.phase||"celebrating"===this.state.phase){for(let e of(this.spawnProtectionTime>0&&(this.spawnProtectionTime-=t),this.balloons))e.update(t);if(this.particleSystem.update(t),"playing"===this.state.phase){let t=this.balloons.find(t=>t.data.letter===this.state.targetLetter&&"floating"===t.data.state);t&&t.isOffScreen()&&(this.callbacks.onMissed(this.state.targetLetter),this.startNewRound())}this.balloons=this.balloons.filter(t=>!t.isDone())}}render(){this.renderer.clear(),this.renderer.drawBackground(),this.renderer.drawBalloons(this.balloons),this.renderer.drawParticles(this.particleSystem.getParticles())}handleTap(t,e){if("playing"!==this.state.phase||this.spawnProtectionTime>0)return;let s=this.canvas.getBoundingClientRect(),a=t-s.left,i=e-s.top;for(let t of[...this.balloons].filter(t=>"floating"===t.data.state).sort((t,e)=>e.data.y-t.data.y))if(t.hitTest(a,i))return void this.handleBalloonTap(t)}handleBalloonTap(t){if(t.data.letter===this.state.targetLetter)t.pop(),this.particleSystem.createExplosion(t.getRenderX(),t.data.y-d.HEIGHT/2,t.data.color,!0),this.state.consecutiveCorrect++,this.state.score++,this.balloons.forEach(t=>t.stopFlash()),this.checkLevelUp(),this.callbacks.onCorrect(t.data.letter),setTimeout(()=>{this.startNewRound()},800);else{this.callbacks.onWrong(t.data.letter,this.state.targetLetter);let e=this.balloons.find(t=>t.data.letter===this.state.targetLetter&&"floating"===t.data.state);e&&(e.startFlash(),setTimeout(()=>e.stopFlash(),2e3))}}checkLevelUp(){let t=this.state.difficulty;if(t>=4)return;let e=m[t-1];this.state.consecutiveCorrect>=e&&(this.state.difficulty=t+1,this.callbacks.onLevelUp(this.state.difficulty))}getState(){return{...this.state}}constructor(t,e){r(this,"canvas",void 0),r(this,"renderer",void 0),r(this,"particleSystem",void 0),r(this,"callbacks",void 0),r(this,"state",{phase:"ready",targetLetter:"",balloons:[],difficulty:1,consecutiveCorrect:0,score:0}),r(this,"balloons",[]),r(this,"lastTime",0),r(this,"animationId",null),r(this,"width",0),r(this,"height",0),r(this,"dpr",1),r(this,"spawnProtectionTime",0),r(this,"SPAWN_PROTECTION_MS",300),r(this,"gameLoop",()=>{let t=performance.now(),e=t-this.lastTime;this.lastTime=t,this.update(e),this.render(),this.animationId=requestAnimationFrame(this.gameLoop)}),this.canvas=t,this.renderer=new c(t),this.particleSystem=new u,this.callbacks=e,this.dpr=window.devicePixelRatio||1}}function x(t){let{letter:e,onTap:s}=t,l=(0,i.useCallback)(t=>{t.stopPropagation(),s()},[s]);return(0,a.jsxs)("button",{onClick:l,onTouchEnd:l,className:" group relative px-6 py-3 bg-white/90 backdrop-blur-sm rounded-full shadow-lg border-2 border-kids-sky/30 transition-all duration-200 hover:scale-105 hover:shadow-xl active:scale-95 cursor-pointer ",children:[(0,a.jsx)("div",{className:" absolute -bottom-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white/90 rotate-45 border-r-2 border-b-2 border-kids-sky/30 "}),(0,a.jsxs)("div",{className:"relative flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-sm text-kids-text-secondary",children:"找到"}),(0,a.jsx)("span",{className:" text-3xl font-bold text-kids-sky group-hover:animate-bounce-soft transition-transform ",children:e}),(0,a.jsx)("span",{className:"text-lg opacity-60 group-hover:opacity-100 transition-opacity",children:"\uD83D\uDD0A"})]})]})}function w(){var t;let e,s,r,o,n,h,d,c,p,u,f,g,m,[w,v]=(0,i.useState)("idle"),[y,k]=(0,i.useState)(0),[C,F]=(0,i.useState)(1),[S,T]=(0,i.useState)(""),M=(e=(0,i.useRef)(null),"u">typeof window&&!e.current&&(e.current=window.speechSynthesis),s=(0,i.useCallback)((t,s)=>{let a=e.current;if(!a)return;a.cancel();let i=new SpeechSynthesisUtterance(t);i.lang="en-US",i.rate=(null==s?void 0:s.rate)??.8,i.pitch=(null==s?void 0:s.pitch)??1.1,i.volume=1;let l=a.getVoices().find(t=>t.name.includes("Samantha")||t.name.includes("Google US English")||"en-US"===t.lang);l&&(i.voice=l),a.speak(i)},[]),r=(0,i.useCallback)(t=>{s(t,{rate:.7,pitch:1.2})},[s]),o=(0,i.useCallback)(t=>{s(t,{rate:.8,pitch:1.3})},[s]),n=(0,i.useCallback)(t=>{s(t,{rate:.8,pitch:1.1})},[s]),h=(0,i.useCallback)(t=>{s(t,{rate:.7,pitch:1.2})},[s]),d=(0,i.useCallback)(t=>{s(t,{rate:.8,pitch:1.2})},[s]),{speak:s,sayLetter:d,sayFind:r,sayCorrect:o,sayWrong:n,sayMissed:h,stop:(0,i.useCallback)(()=>{var t;null==(t=e.current)||t.cancel()},[])}),P=(0,i.useCallback)(t=>{k(t=>t+1),M.sayLetter(t)},[M]),N=(0,i.useCallback)((t,e)=>{M.sayLetter(t)},[M]),B=(0,i.useCallback)(t=>{},[]),R=(0,i.useCallback)(t=>{F(t)},[]),E=(0,i.useCallback)(t=>{T(t),setTimeout(()=>{M.sayLetter(t)},300)},[M]),I=(0,i.useCallback)(()=>{S&&M.sayLetter(S)},[S,M]),{canvasRef:L,containerRef:j,startGame:A,handleTap:_}=(t={onCorrect:P,onWrong:N,onMissed:B,onLevelUp:R,onNewRound:E},c=(0,i.useRef)(null),p=(0,i.useRef)(null),u=(0,i.useRef)(null),(f=(0,i.useRef)(t)).current=t,(0,i.useEffect)(()=>{let t=u.current;if(!t)return;let e=new ResizeObserver(()=>{let e=p.current;if(!e)return;let s=t.getBoundingClientRect();s.width>0&&s.height>0&&e.resize(s.width,s.height)});return e.observe(t),()=>{var t;e.disconnect(),null==(t=p.current)||t.stop()}},[]),g=(0,i.useCallback)(()=>{if(p.current)return;let t=c.current,e=u.current;t&&e&&(p.current=new b(t,{onCorrect:t=>f.current.onCorrect(t),onWrong:(t,e)=>f.current.onWrong(t,e),onMissed:t=>f.current.onMissed(t),onLevelUp:t=>f.current.onLevelUp(t),onNewRound:t=>f.current.onNewRound(t)}))},[]),m=(0,i.useCallback)(()=>{let t=u.current;if(!t)return;g();let e=p.current;if(!e)return;let s=t.getBoundingClientRect();s.width>0&&s.height>0&&e.resize(s.width,s.height),e.start()},[g]),{canvasRef:c,containerRef:u,startGame:m,stopGame:(0,i.useCallback)(()=>{var t;null==(t=p.current)||t.stop()},[]),handleTap:(0,i.useCallback)(t=>{let e,s;if(p.current){if("touches"in t){if(0===t.touches.length)return;e=t.touches[0].clientX,s=t.touches[0].clientY}else e=t.clientX,s=t.clientY;p.current.handleTap(e,s)}},[])}),D=(0,i.useCallback)(()=>{v("playing"),k(0),F(1),requestAnimationFrame(()=>{A()})},[A]);return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 w-full max-w-lg mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between w-full px-2",children:[(0,a.jsxs)(l.N_,{to:"/",className:"group flex items-center gap-2 px-3 py-2 rounded-full bg-white/60 hover:bg-white/90 transition-all duration-300 active:scale-95",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83C\uDFE0"}),(0,a.jsx)("span",{className:"text-sm font-medium text-kids-text-secondary",children:"返回"})]}),"playing"===w&&(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"text-sm text-kids-text-muted",children:["难度 ",C]}),(0,a.jsxs)("span",{className:"text-lg font-bold text-kids-text",children:["⭐ ",y]})]})]}),(0,a.jsxs)("div",{ref:j,className:"relative w-full aspect-[3/4] max-h-[70vh] bg-gradient-to-b from-kids-bg-sky to-kids-bg-cream rounded-2xl overflow-hidden shadow-lg touch-none",onMouseDown:"playing"===w?_:void 0,onTouchStart:"playing"===w?_:void 0,children:[(0,a.jsx)("canvas",{ref:L,className:"absolute inset-0 w-full h-full"}),"playing"===w&&S&&(0,a.jsx)("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-10",children:(0,a.jsx)(x,{letter:S,onTap:I})}),"idle"===w&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-6 bg-white/30 backdrop-blur-sm",children:[(0,a.jsx)("div",{className:"text-6xl animate-bounce-soft",children:"\uD83C\uDF88"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-kids-text",children:"字母气球"}),(0,a.jsx)("button",{onClick:D,className:"px-8 py-4 text-xl font-bold text-white bg-kids-sky rounded-full shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all",children:"开始游戏 ▶"})]})]})]})}function v(){return(0,a.jsx)(w,{})}}}]);